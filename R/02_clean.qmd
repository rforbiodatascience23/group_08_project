---
title: "02_clean"
format: html
editor: visual
---

# Cleaning the data

```{r}
#| echo: false
library("tidyverse")
```

```{r}
# First we explore the data
expression_data |> 
  sample_n(10)
```

**Columns:**

1.  **Name** which include the gene names.
2.  **Identifier** which includes a link to the ENSG identifier for the gene.
3.  40 columns for each sample. They start with 20756_0XX_genes - Total counts. Where XX is the number of the sample.

Our dataset does not includes any N/A values, so we do not need to take that into account when cleaning.

**Cleaning procedure:**

-   Create tidy data

-   Clean up names

```{r}
expression_data_long <- expression_data |> 
  
  #Pivot longer to make into tidy data set.
  pivot_longer(cols = starts_with("20756"),
               names_to = "Sample",
               values_to = "Count") |>
  
  # Change to sample number
  mutate(Sample = as.numeric(str_sub(Sample, 
                                     start = 7, 
                                     end = 9))) |>  
  # Rename Name column 
  rename("Gene" = "Name")
```

# Joining meta data and expression data

```{r}
# Connect the expression dataset Sample with the metadata set ID
full_expression_data <- full_join(x = expression_data_long, 
                                   y = meta_data, 
                                   join_by(Sample == ID))

write_csv(full_expression_data, 
          "../data/full_expression_data.csv")
```
